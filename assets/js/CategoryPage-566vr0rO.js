import{a as e,r as s,j as t,B as r,h as i,aq as a,I as n,ar as o,as as l,T as d,x as c,a7 as x,A as h,at as p,au as u,av as g,aw as f,f as m,z as j,ac as b,ax as y,ay as w,az as v,G as S,aA as C,k}from"./mui-CYltanDZ.js";import{u as F,a as W,L as z,b as _}from"./index-DrWM8ftA.js";import{c as I,u as L}from"./router-Bir15TBb.js";import"./vendor-HnKmhvXM.js";import"./utils-CSgk65FE.js";const M=()=>{const{categoryId:M}=I(),A=L(),P=e("(max-width:768px)"),T=e("(max-width:1024px)"),{addToCart:E,isLoggedIn:R,login:H}=F(),[O,D]=s.useState(null),[N,B]=s.useState([]),[$,U]=s.useState([]),[q,G]=s.useState([]),[Y,K]=s.useState(!0),[Q,Z]=s.useState(!1),[J,V]=s.useState({open:!1,message:"",severity:"success"}),[X,ee]=s.useState(null),[se,te]=s.useState(!1),[re,ie]=s.useState(null),[ae,ne]=s.useState(""),[oe,le]=s.useState([0,1e5]),[de,ce]=s.useState("newest"),[xe,he]=s.useState("");s.useEffect(()=>{M&&pe()},[M]),s.useEffect(()=>{ue()},[$,ae,oe,de,xe]);const pe=async()=>{try{K(!0);const e=await W.get("/categories"),s=e.data?.categories||[];B(s);const t=s.find(e=>e.category_id===M);D(t),ne(M);const r=await W.get(`/products?category_id=${M}`);U(r.data?.products||[])}catch(e){}finally{K(!1)}},ue=async()=>{let e=[...$];if(xe.trim())try{const s=await W.get(`/search?q=${encodeURIComponent(xe.trim())}`);s.data?.success&&(e=s.data.products||[])}catch(s){const t=xe.toLowerCase().trim();e=e.filter(e=>e.name.toLowerCase().includes(t))}ae&&ae!==M&&(e=e.filter(e=>e.category_id===ae)),e=e.filter(e=>{const s=parseFloat(e.price)||0;return s>=oe[0]&&s<=oe[1]}),e.sort((e,s)=>{switch(de){case"price-low":return(parseFloat(e.price)||0)-(parseFloat(s.price)||0);case"price-high":return(parseFloat(s.price)||0)-(parseFloat(e.price)||0);case"name":return e.name.localeCompare(s.name);default:return new Date(s.created_at||0)-new Date(e.created_at||0)}}),G(e)},ge=async e=>{if(R){ee(e.product_id);try{await E(e,1),V({open:!0,message:"Added to cart successfully!",severity:"success"})}catch(s){"LOGIN_REQUIRED"===s.message?Z(!0):"OUT_OF_STOCK"===s.message?V({open:!0,message:"Sorry, this product is currently out of stock",severity:"warning"}):V({open:!0,message:s.message||"Failed to add to cart",severity:"error"})}finally{ee(null)}}else Z(!0)},fe=e=>{const s=e.target.value;ne(s),s&&s!==M&&"all"!==s&&A(`/category/${s}`)},me=(e,s)=>{le(s)},je=e=>{ce(e.target.value)},be=e=>{he(e.target.value)},ye=()=>{ne(M),le([0,1e5]),ce("newest"),he("")},we=()=>t.jsxs(r,{sx:{width:T?320:380,p:3,height:"fit-content",position:"sticky",top:20},children:[t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(d,{variant:"h6",sx:{fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:"Filters"}),t.jsx(i,{onClick:ye,size:"small",sx:{textTransform:"none",color:"#e74c3c"},children:"Clear All"})]}),t.jsxs(p,{defaultExpanded:!0,sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:[t.jsx(u,{expandIcon:t.jsx(g,{}),children:t.jsx(d,{sx:{fontWeight:500,fontFamily:'"Montserrat", sans-serif'},children:"Search Products"})}),t.jsx(f,{children:t.jsx(m,{fullWidth:!0,size:"small",placeholder:"Search by product name...",value:xe,onChange:be,InputProps:{startAdornment:t.jsx(j,{position:"start",children:t.jsx(b,{sx:{color:"text.secondary",fontSize:20}})})},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ddd"},"&:hover fieldset":{borderColor:"#e74c3c"},"&.Mui-focused fieldset":{borderColor:"#e74c3c"}}}})})]}),t.jsxs(p,{defaultExpanded:!0,sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:[t.jsx(u,{expandIcon:t.jsx(g,{}),children:t.jsx(d,{sx:{fontWeight:500,fontFamily:'"Montserrat", sans-serif'},children:"Category"})}),t.jsx(f,{children:t.jsxs(y,{fullWidth:!0,size:"small",children:[t.jsx(w,{children:"Select Category"}),t.jsxs(v,{value:ae,onChange:fe,label:"Select Category",children:[t.jsx(S,{value:"all",children:"All Products"}),N.map(e=>t.jsx(S,{value:e.category_id,children:e.category_name},e.category_id))]})]})})]}),t.jsxs(p,{defaultExpanded:!0,sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:[t.jsx(u,{expandIcon:t.jsx(g,{}),children:t.jsx(d,{sx:{fontWeight:500,fontFamily:'"Montserrat", sans-serif'},children:"Price Range"})}),t.jsx(f,{children:t.jsxs(r,{sx:{px:1},children:[t.jsx(C,{value:oe,onChange:me,valueLabelDisplay:"auto",min:0,max:1e5,step:1e3,sx:{mb:2}}),t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between"},children:[t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:["₹",oe[0].toLocaleString()]}),t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:["₹",oe[1].toLocaleString()]})]})]})})]}),t.jsxs(p,{defaultExpanded:!0,sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:[t.jsx(u,{expandIcon:t.jsx(g,{}),children:t.jsx(d,{sx:{fontWeight:500,fontFamily:'"Montserrat", sans-serif'},children:"Sort By"})}),t.jsx(f,{children:t.jsx(y,{fullWidth:!0,size:"small",children:t.jsxs(v,{value:de,onChange:je,children:[t.jsx(S,{value:"newest",children:"Newest First"}),t.jsx(S,{value:"price-low",children:"Price: Low to High"}),t.jsx(S,{value:"price-high",children:"Price: High to Low"}),t.jsx(S,{value:"name",children:"Name: A to Z"})]})})})]})]});return Y?t.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:t.jsx(r,{sx:{width:20,height:20,border:"2px solid #333",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):t.jsxs(r,{sx:{width:"100%",maxWidth:1600,mx:"auto",mt:4,px:{xs:1,sm:2,md:3}},children:[t.jsxs(r,{sx:{mb:4},children:[t.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[t.jsx(i,{startIcon:t.jsx(a,{}),onClick:()=>A("/"),sx:{color:"#333",textTransform:"none"},children:"Back to Home"}),P&&"153236582156"!==M&&t.jsxs(r,{sx:{display:"flex",gap:1},children:[t.jsx(n,{onClick:()=>te(!0),sx:{color:"#333"},children:t.jsx(o,{})}),t.jsx(n,{sx:{color:"#333"},children:t.jsx(l,{})})]})]}),t.jsx(d,{variant:"h5",sx:{fontWeight:600,color:"#222",fontFamily:'"Montserrat", sans-serif',fontSize:{xs:"1.2rem",sm:"1.5rem"},mb:1},children:O?.name||"Category Products"}),t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{mb:3,fontFamily:'"Nunito Sans", sans-serif'},children:[q.length," product",1!==q.length?"s":""," found"]})]}),t.jsxs(r,{sx:{display:"flex",gap:{xs:0,sm:2,md:3}},children:[!P&&"153236582156"!==M&&we(),t.jsx(r,{sx:{flex:1,minWidth:0},children:q.length>0?t.jsx(r,{sx:{display:"grid",gridTemplateColumns:"153236582156"===M?{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}:"none",gap:{xs:1,sm:2,md:3},justifyContent:"center",..."153236582156"!==M&&{display:"flex",flexWrap:"wrap",gap:{xs:.5,sm:2},justifyContent:"flex-start"}},children:q.map(e=>(e=>{const s=parseFloat(e.original_price)||0,a=parseFloat(e.price)||0,o=s>0&&a<s?Math.round((s-a)/s*100):0,l=e.primary_image||(e.images&&e.images.length>0?e.images[0]:null),c=l&&(l.includes("b-cdn.net")||l.startsWith("https://")),x=l,h=e.images&&e.images.length>1?e.images[1]:c?l.replace("_v1.png","_v2.png"):l+"_v2.png",p=()=>{A(`/product/${e.product_id}`)};return"153236582156"===M?t.jsx(r,{sx:{width:"100%",position:"relative",borderRadius:2,overflow:"hidden",transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)"}},children:t.jsxs(r,{sx:{position:"relative",width:"100%",height:P?250:400,backgroundImage:`url(${x})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",display:"flex",alignItems:"flex-end",justifyContent:"flex-end",p:2,cursor:"pointer"},onClick:p,onMouseEnter:()=>ie(e.product_id),onMouseLeave:()=>ie(null),children:[t.jsx(r,{sx:{position:"absolute",bottom:0,left:0,right:0,height:"60%",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",zIndex:1}}),o>0&&t.jsxs(r,{sx:{position:"absolute",top:8,left:8,backgroundColor:"#e74c3c",color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.7rem",fontWeight:600,fontFamily:"Montserrat, sans-serif",zIndex:2},children:["-",o,"%"]}),t.jsxs(r,{sx:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1,maxWidth:"70%"},children:[t.jsx(d,{sx:{fontFamily:'"Montserrat", sans-serif',fontWeight:600,fontSize:P?12:14,color:"white",textAlign:"right",textTransform:"uppercase",letterSpacing:.5,textShadow:"0 2px 4px rgba(0,0,0,0.7)",lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:e.name}),t.jsxs(d,{sx:{fontFamily:'"Montserrat", sans-serif',fontWeight:700,fontSize:P?14:16,color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.7)"},children:["₹",a.toLocaleString()]}),t.jsx(i,{variant:"contained",size:"small",onClick:s=>{s.stopPropagation(),ge(e)},disabled:X===e.product_id,sx:{background:"linear-gradient(135deg, #E91E63 0%, #C2185B 100%)",color:"white",fontWeight:600,textTransform:"none",fontSize:P?"0.7rem":"0.8rem",px:2,py:.5,borderRadius:2,boxShadow:"0 2px 8px rgba(233, 30, 99, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{background:"linear-gradient(135deg, #C2185B 0%, #AD1457 100%)",boxShadow:"0 4px 12px rgba(233, 30, 99, 0.4)",transform:"translateY(-1px)"},"&:disabled":{background:"linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%)",color:"#666",boxShadow:"none",transform:"none"}},children:X===e.product_id?"Adding...":"Add to Cart"})]})]})},e.product_id):t.jsxs(r,{sx:{width:P?"calc(50% - 4px)":"280px",maxWidth:P?"calc(50% - 4px)":"280px",flexShrink:0,textAlign:"center",p:.5,overflow:"hidden",position:"relative"},children:[t.jsxs(r,{sx:{position:"relative",width:"100%",height:P?160:280,mb:1,borderRadius:2,overflow:"hidden",cursor:"pointer"},onClick:p,onMouseEnter:()=>ie(e.product_id),onMouseLeave:()=>ie(null),children:[t.jsx(_,{src:x,alt:e.name,height:"100%",sx:{width:"100%",height:"100%",objectFit:"contain",maxWidth:"100%",maxHeight:"100%",transition:"opacity 0.3s ease",position:"absolute",top:0,left:0,zIndex:1},placeholder:"Loading..."}),t.jsx(_,{src:h,alt:e.name,height:"100%",sx:{width:"100%",height:"100%",objectFit:"contain",maxWidth:"100%",maxHeight:"100%",position:"absolute",top:0,left:0,opacity:re===e.product_id?1:0,visibility:re===e.product_id?"visible":"hidden",transition:"opacity 0.3s ease, visibility 0.3s ease",zIndex:2},placeholder:"Loading..."}),o>0&&t.jsxs(r,{sx:{position:"absolute",top:8,left:8,backgroundColor:"#e74c3c",color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.7rem",fontWeight:600,fontFamily:"Montserrat, sans-serif",zIndex:1},children:["-",o,"%"]}),t.jsx(n,{onClick:s=>{s.stopPropagation(),ge(e)},disabled:X===e.product_id,sx:{position:"absolute",bottom:8,right:8,backgroundColor:"rgba(255,255,255,0.9)",color:"#333",width:32,height:32,"&:hover":{backgroundColor:"rgba(255,255,255,1)",transform:"scale(1.1)"},"&:disabled":{opacity:.7}},children:X===e.product_id?t.jsx(r,{sx:{width:18,height:18,border:"2px solid #333",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}):t.jsx(k,{sx:{fontSize:18}})})]}),t.jsx(d,{sx:{fontSize:{xs:11,sm:14},fontWeight:500,color:"#333",mb:.5,lineHeight:1.3,fontFamily:'"Montserrat", sans-serif',textTransform:"uppercase",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",wordBreak:"break-word",width:"100%",maxWidth:"100%",minHeight:"40px"},children:e.name}),t.jsx(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:o>0?t.jsxs(t.Fragment,{children:[t.jsxs(d,{sx:{fontSize:{xs:10,sm:12},color:"#999",textDecoration:"line-through",fontFamily:'"Nunito Sans", sans-serif'},children:["₹",s.toLocaleString()]}),t.jsxs(d,{sx:{fontSize:{xs:12,sm:16},fontWeight:700,color:"#e74c3c",fontFamily:'"Montserrat", sans-serif'},children:["₹",a.toLocaleString()]})]}):t.jsxs(d,{sx:{fontSize:{xs:12,sm:16},fontWeight:700,color:"#333",fontFamily:'"Montserrat", sans-serif'},children:["₹",a.toLocaleString()]})})]},e.product_id)})(e))}):t.jsxs(r,{sx:{textAlign:"center",py:8,color:"text.secondary"},children:[t.jsx(d,{variant:"h6",sx:{mb:2,fontFamily:'"Montserrat", sans-serif'},children:"No products found with current filters"}),t.jsx(d,{variant:"body1",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:"Try adjusting your filters or check back later!"})]})})]}),t.jsx(c,{anchor:"left",open:se,onClose:()=>te(!1),PaperProps:{sx:{width:T?320:380}},children:we()}),t.jsx(z,{open:Q,onClose:()=>Z(!1),onLoginSuccess:e=>{Z(!1),H(e)},message:"Please login to add items to cart"}),t.jsx(x,{open:J.open,autoHideDuration:3e3,onClose:()=>V({...J,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:t.jsx(h,{onClose:()=>V({...J,open:!1}),severity:J.severity,sx:{width:"100%"},children:J.message})}),t.jsx("style",{children:"\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      "})]})};export{M as default};
