import{a as e,r as s,j as t,B as r,h as i,aq as a,I as o,ar as n,as as l,T as d,x as c,a7 as x,A as h,at as p,au as m,av as u,aw as f,f as g,z as j,ac as y,ax as b,ay as w,az as v,G as S,aA as C,k}from"./mui-CYltanDZ.js";import{u as F,a as W,L as _}from"./index-DF1dA_K7.js";import{c as z,u as I}from"./router-Bir15TBb.js";import"./vendor-HnKmhvXM.js";import"./utils-CSgk65FE.js";const M=()=>{const{categoryId:M}=z(),L=I(),E=e("(max-width:768px)"),A=e("(max-width:1024px)"),{addToCart:P,isLoggedIn:T,login:R}=F(),[N,H]=s.useState(null),[O,D]=s.useState([]),[B,$]=s.useState([]),[U,q]=s.useState([]),[G,Y]=s.useState(!0),[K,Q]=s.useState(!1),[Z,J]=s.useState({open:!1,message:"",severity:"success"}),[V,X]=s.useState(null),[ee,se]=s.useState(!1),[te,re]=s.useState(null),[ie,ae]=s.useState(""),[oe,ne]=s.useState([0,1e5]),[le,de]=s.useState("newest"),[ce,xe]=s.useState("");s.useEffect(()=>{M&&he()},[M]),s.useEffect(()=>{pe()},[B,ie,oe,le,ce]);const he=async()=>{try{Y(!0);const e=await W.get("/categories"),s=e.data?.categories||[];D(s);const t=s.find(e=>e.category_id===M);H(t),ae(M);const r=await W.get(`/products?category_id=${M}`);$(r.data?.products||[])}catch(e){}finally{Y(!1)}},pe=async()=>{let e=[...B];if(ce.trim())try{const s=await W.get(`/search?q=${encodeURIComponent(ce.trim())}`);s.data?.success&&(e=s.data.products||[])}catch(s){const t=ce.toLowerCase().trim();e=e.filter(e=>e.name.toLowerCase().includes(t))}ie&&ie!==M&&(e=e.filter(e=>e.category_id===ie)),e=e.filter(e=>{const s=parseFloat(e.price)||0;return s>=oe[0]&&s<=oe[1]}),e.sort((e,s)=>{switch(le){case"price-low":return(parseFloat(e.price)||0)-(parseFloat(s.price)||0);case"price-high":return(parseFloat(s.price)||0)-(parseFloat(e.price)||0);case"name":return e.name.localeCompare(s.name);default:return new Date(s.created_at||0)-new Date(e.created_at||0)}}),q(e)},me=async e=>{if(T){X(e.product_id);try{await P(e,1),J({open:!0,message:"Added to cart successfully!",severity:"success"})}catch(s){"LOGIN_REQUIRED"===s.message?Q(!0):"OUT_OF_STOCK"===s.message?J({open:!0,message:"Sorry, this product is currently out of stock",severity:"warning"}):J({open:!0,message:s.message||"Failed to add to cart",severity:"error"})}finally{X(null)}}else Q(!0)},ue=e=>{const s=e.target.value;ae(s),s&&s!==M&&"all"!==s&&L(`/category/${s}`)},fe=(e,s)=>{ne(s)},ge=e=>{de(e.target.value)},je=e=>{xe(e.target.value)},ye=()=>{ae(M),ne([0,1e5]),de("newest"),xe("")},be=()=>t.jsxs(r,{sx:{width:A?320:380,p:3,height:"fit-content",position:"sticky",top:20},children:[t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(d,{variant:"h6",sx:{fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:"Filters"}),t.jsx(i,{onClick:ye,size:"small",sx:{textTransform:"none",color:"#e74c3c"},children:"Clear All"})]}),t.jsxs(p,{defaultExpanded:!0,sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:[t.jsx(m,{expandIcon:t.jsx(u,{}),children:t.jsx(d,{sx:{fontWeight:500,fontFamily:'"Montserrat", sans-serif'},children:"Search Products"})}),t.jsx(f,{children:t.jsx(g,{fullWidth:!0,size:"small",placeholder:"Search by product name...",value:ce,onChange:je,InputProps:{startAdornment:t.jsx(j,{position:"start",children:t.jsx(y,{sx:{color:"text.secondary",fontSize:20}})})},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#ddd"},"&:hover fieldset":{borderColor:"#e74c3c"},"&.Mui-focused fieldset":{borderColor:"#e74c3c"}}}})})]}),t.jsxs(p,{defaultExpanded:!0,sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:[t.jsx(m,{expandIcon:t.jsx(u,{}),children:t.jsx(d,{sx:{fontWeight:500,fontFamily:'"Montserrat", sans-serif'},children:"Category"})}),t.jsx(f,{children:t.jsxs(b,{fullWidth:!0,size:"small",children:[t.jsx(w,{children:"Select Category"}),t.jsxs(v,{value:ie,onChange:ue,label:"Select Category",children:[t.jsx(S,{value:"all",children:"All Products"}),O.map(e=>t.jsx(S,{value:e.category_id,children:e.category_name},e.category_id))]})]})})]}),t.jsxs(p,{defaultExpanded:!0,sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:[t.jsx(m,{expandIcon:t.jsx(u,{}),children:t.jsx(d,{sx:{fontWeight:500,fontFamily:'"Montserrat", sans-serif'},children:"Price Range"})}),t.jsx(f,{children:t.jsxs(r,{sx:{px:1},children:[t.jsx(C,{value:oe,onChange:fe,valueLabelDisplay:"auto",min:0,max:1e5,step:1e3,sx:{mb:2}}),t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between"},children:[t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:["₹",oe[0].toLocaleString()]}),t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:["₹",oe[1].toLocaleString()]})]})]})})]}),t.jsxs(p,{defaultExpanded:!0,sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:[t.jsx(m,{expandIcon:t.jsx(u,{}),children:t.jsx(d,{sx:{fontWeight:500,fontFamily:'"Montserrat", sans-serif'},children:"Sort By"})}),t.jsx(f,{children:t.jsx(b,{fullWidth:!0,size:"small",children:t.jsxs(v,{value:le,onChange:ge,children:[t.jsx(S,{value:"newest",children:"Newest First"}),t.jsx(S,{value:"price-low",children:"Price: Low to High"}),t.jsx(S,{value:"price-high",children:"Price: High to Low"}),t.jsx(S,{value:"name",children:"Name: A to Z"})]})})})]})]});return G?t.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:t.jsx(r,{sx:{width:20,height:20,border:"2px solid #333",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):t.jsxs(r,{sx:{width:"100%",maxWidth:1600,mx:"auto",mt:4,px:{xs:1,sm:2,md:3}},children:[t.jsxs(r,{sx:{mb:4},children:[t.jsxs(r,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[t.jsx(i,{startIcon:t.jsx(a,{}),onClick:()=>L("/"),sx:{color:"#333",textTransform:"none"},children:"Back to Home"}),E&&"153236582156"!==M&&t.jsxs(r,{sx:{display:"flex",gap:1},children:[t.jsx(o,{onClick:()=>se(!0),sx:{color:"#333"},children:t.jsx(n,{})}),t.jsx(o,{sx:{color:"#333"},children:t.jsx(l,{})})]})]}),t.jsx(d,{variant:"h5",sx:{fontWeight:600,color:"#222",fontFamily:'"Montserrat", sans-serif',fontSize:{xs:"1.2rem",sm:"1.5rem"},mb:1},children:N?.name||"Category Products"}),t.jsxs(d,{variant:"body2",color:"text.secondary",sx:{mb:3,fontFamily:'"Nunito Sans", sans-serif'},children:[U.length," product",1!==U.length?"s":""," found"]})]}),t.jsxs(r,{sx:{display:"flex",gap:{xs:0,sm:2,md:3}},children:[!E&&"153236582156"!==M&&be(),t.jsx(r,{sx:{flex:1,minWidth:0},children:U.length>0?t.jsx(r,{sx:{display:"grid",gridTemplateColumns:"153236582156"===M?{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"}:"none",gap:{xs:1,sm:2,md:3},justifyContent:"center",..."153236582156"!==M&&{display:"flex",flexWrap:"wrap",gap:{xs:.5,sm:2},justifyContent:"flex-start"}},children:U.map(e=>(e=>{const s=parseFloat(e.original_price)||0,a=parseFloat(e.price)||0,n=s>0&&a<s?Math.round((s-a)/s*100):0,l=e.primary_image||(e.images&&e.images.length>0?e.images[0]:null),c=l+"_v1.png",x=l+"_v2.png",h=()=>{L(`/product/${e.product_id}`)};return"153236582156"===M?t.jsx(r,{sx:{width:"100%",position:"relative",borderRadius:2,overflow:"hidden",transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(0,0,0,0.15)"}},children:t.jsxs(r,{sx:{position:"relative",width:"100%",height:E?250:400,backgroundImage:`url(${c})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",display:"flex",alignItems:"flex-end",justifyContent:"flex-end",p:2,cursor:"pointer"},onClick:h,onMouseEnter:()=>re(e.product_id),onMouseLeave:()=>re(null),children:[t.jsx(r,{sx:{position:"absolute",bottom:0,left:0,right:0,height:"60%",background:"linear-gradient(transparent, rgba(0,0,0,0.8))",zIndex:1}}),n>0&&t.jsxs(r,{sx:{position:"absolute",top:8,left:8,backgroundColor:"#e74c3c",color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.7rem",fontWeight:600,fontFamily:"Montserrat, sans-serif",zIndex:2},children:["-",n,"%"]}),t.jsxs(r,{sx:{position:"relative",zIndex:2,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1,maxWidth:"70%"},children:[t.jsx(d,{sx:{fontFamily:'"Montserrat", sans-serif',fontWeight:600,fontSize:E?12:14,color:"white",textAlign:"right",textTransform:"uppercase",letterSpacing:.5,textShadow:"0 2px 4px rgba(0,0,0,0.7)",lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:e.name}),t.jsxs(d,{sx:{fontFamily:'"Montserrat", sans-serif',fontWeight:700,fontSize:E?14:16,color:"white",textShadow:"0 2px 4px rgba(0,0,0,0.7)"},children:["₹",a.toLocaleString()]}),t.jsx(i,{variant:"contained",size:"small",onClick:s=>{s.stopPropagation(),me(e)},disabled:V===e.product_id,sx:{background:"linear-gradient(135deg, #E91E63 0%, #C2185B 100%)",color:"white",fontWeight:600,textTransform:"none",fontSize:E?"0.7rem":"0.8rem",px:2,py:.5,borderRadius:2,boxShadow:"0 2px 8px rgba(233, 30, 99, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{background:"linear-gradient(135deg, #C2185B 0%, #AD1457 100%)",boxShadow:"0 4px 12px rgba(233, 30, 99, 0.4)",transform:"translateY(-1px)"},"&:disabled":{background:"linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%)",color:"#666",boxShadow:"none",transform:"none"}},children:V===e.product_id?"Adding...":"Add to Cart"})]})]})},e.product_id):t.jsxs(r,{sx:{width:E?"calc(50% - 4px)":"280px",maxWidth:E?"calc(50% - 4px)":"280px",flexShrink:0,textAlign:"center",p:.5,overflow:"hidden",position:"relative"},children:[t.jsxs(r,{sx:{position:"relative",width:"100%",height:E?160:280,mb:1,borderRadius:2,overflow:"hidden",cursor:"pointer"},onClick:h,onMouseEnter:()=>re(e.product_id),onMouseLeave:()=>re(null),children:[t.jsx("img",{className:"v1-img",src:c,alt:e.name,style:{width:"100%",height:"100%",objectFit:"contain",maxWidth:"100%",maxHeight:"100%",transition:"opacity 0.3s ease"},onError:e=>{e.target.style.display="none"}}),t.jsx("img",{className:"v2-img",src:x,alt:e.name,style:{width:"100%",height:"100%",objectFit:"contain",maxWidth:"100%",maxHeight:"100%",position:"absolute",top:0,left:0,opacity:te===e.product_id?1:0,visibility:te===e.product_id?"visible":"hidden",transition:"opacity 0.3s ease, visibility 0.3s ease"},onError:e=>{e.target.style.opacity="0",e.target.style.visibility="hidden"}}),n>0&&t.jsxs(r,{sx:{position:"absolute",top:8,left:8,backgroundColor:"#e74c3c",color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.7rem",fontWeight:600,fontFamily:"Montserrat, sans-serif",zIndex:1},children:["-",n,"%"]}),t.jsx(o,{onClick:s=>{s.stopPropagation(),me(e)},disabled:V===e.product_id,sx:{position:"absolute",bottom:8,right:8,backgroundColor:"rgba(255,255,255,0.9)",color:"#333",width:32,height:32,"&:hover":{backgroundColor:"rgba(255,255,255,1)",transform:"scale(1.1)"},"&:disabled":{opacity:.7}},children:V===e.product_id?t.jsx(r,{sx:{width:18,height:18,border:"2px solid #333",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}):t.jsx(k,{sx:{fontSize:18}})})]}),t.jsx(d,{sx:{fontSize:{xs:11,sm:14},fontWeight:500,color:"#333",mb:.5,lineHeight:1.3,fontFamily:'"Montserrat", sans-serif',textTransform:"uppercase",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",wordBreak:"break-word",width:"100%",maxWidth:"100%",minHeight:"40px"},children:e.name}),t.jsx(r,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5},children:n>0?t.jsxs(t.Fragment,{children:[t.jsxs(d,{sx:{fontSize:{xs:10,sm:12},color:"#999",textDecoration:"line-through",fontFamily:'"Nunito Sans", sans-serif'},children:["₹",s.toLocaleString()]}),t.jsxs(d,{sx:{fontSize:{xs:12,sm:16},fontWeight:700,color:"#e74c3c",fontFamily:'"Montserrat", sans-serif'},children:["₹",a.toLocaleString()]})]}):t.jsxs(d,{sx:{fontSize:{xs:12,sm:16},fontWeight:700,color:"#333",fontFamily:'"Montserrat", sans-serif'},children:["₹",a.toLocaleString()]})})]},e.product_id)})(e))}):t.jsxs(r,{sx:{textAlign:"center",py:8,color:"text.secondary"},children:[t.jsx(d,{variant:"h6",sx:{mb:2,fontFamily:'"Montserrat", sans-serif'},children:"No products found with current filters"}),t.jsx(d,{variant:"body1",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:"Try adjusting your filters or check back later!"})]})})]}),t.jsx(c,{anchor:"left",open:ee,onClose:()=>se(!1),PaperProps:{sx:{width:A?320:380}},children:be()}),t.jsx(_,{open:K,onClose:()=>Q(!1),onLoginSuccess:e=>{Q(!1),R(e)},message:"Please login to add items to cart"}),t.jsx(x,{open:Z.open,autoHideDuration:3e3,onClose:()=>J({...Z,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:t.jsx(h,{onClose:()=>J({...Z,open:!1}),severity:Z.severity,sx:{width:"100%"},children:Z.message})}),t.jsx("style",{jsx:!0,children:"\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      "})]})};export{M as default};
