import{a as e,r as s,j as a,B as t,I as r,an as i,T as n,S as o,d as l,e as d,N as c,ay as h,h as x,C as m,a7 as p,A as u,m as y,au as f,az as j,aA as g,aB as b,J as v,aC as w,aD as C,f as _,aE as S,aF as z,ak as N}from"./mui-CLbw_gaj.js";import{u as k,a as F}from"./index-Cnr8SIWr.js";import{u as W}from"./router-BiFerjYI.js";import"./vendor-HnKmhvXM.js";import"./utils-CeR3a_hx.js";const P=["Cart Review","Shipping Details","Payment"],E=()=>{const E=W();e("(max-width:768px)");const{cartItems:$,getCartTotal:M,isLoggedIn:I,customerData:q}=k(),[O,L]=s.useState(0),[D,R]=s.useState(!1),[B,T]=s.useState({open:!1,message:"",severity:"success"}),[A,H]=s.useState({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",country:"India",pincode:"",landmark:""}),[U,G]=s.useState("razorpay"),[J,Q]=s.useState(!0),[Y,K]=s.useState(!0),[V,X]=s.useState(!0),[Z,ee]=s.useState({subtotal:0,shipping:0,tax:0,total:0});s.useEffect(()=>{I&&0!==$.length?(q&&H(e=>({...e,email:q.email||"",firstName:q.name?.split(" ")[0]||"",lastName:q.name?.split(" ").slice(1).join(" ")||""})),ae(),se()):E("/")},[I,$,q,E]);const se=async()=>{try{const e=await F.get("/settings"),s=e.data?.settings||{};Q(!1!==s.cod_enabled),K(!1!==s.razorpay_enabled),X(!1!==s.shiprocket_enabled)}catch(e){}},ae=()=>{const e=M();ee({subtotal:e,shipping:0,tax:0,total:e})},te=e=>s=>{H(a=>({...a,[e]:s.target.value}))},re=()=>{const e=["firstName","lastName","email","phone","address","city","state","pincode"].filter(e=>!A[e].trim());if(e.length>0)return T({open:!0,message:`Please fill in all required fields: ${e.join(", ")}`,severity:"error"}),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(A.email))return T({open:!0,message:"Please enter a valid email address",severity:"error"}),!1;if(!/^[6-9]\d{9}$/.test(A.phone))return T({open:!0,message:"Please enter a valid 10-digit phone number",severity:"error"}),!1;return!!/^[1-9][0-9]{5}$/.test(A.pincode)||(T({open:!0,message:"Please enter a valid 6-digit pincode",severity:"error"}),!1)},ie=()=>{0!==O?ne():L(1)},ne=async()=>{if(re()){R(!0);try{const e={customer_details:A,items:$,payment_method:U,order_summary:Z,shiprocket_enabled:V},s=await F.post("/orders/create",e);if(!s.data.success)throw new Error(s.data.error||"Failed to create order");{const e=s.data.order_id,a=s.data.total_amount;if("razorpay"===U&&Y&&e){const s={order_id:e,total:a};await oe(s)}else E(`/order-success/${e}`)}}catch(e){T({open:!0,message:e.response?.data?.message||e.message||"Failed to place order. Please try again.",severity:"error"})}finally{R(!1)}}},oe=async e=>{try{try{const e=await F.get("/payment/razorpay/status");if(!e.data.configured||!e.data.enabled)throw new Error(e.data.message||"Payment gateway not available")}catch(s){}const a=await F.post("/payment/razorpay/create",{order_id:e.order_id,amount:Z.total,currency:"INR",customer_details:A});if(!a.data.success)throw new Error(a.data.error||"Failed to initialize payment");{const s={key:a.data.razorpay_key,amount:a.data.amount,currency:"INR",name:"Sardar Fashions",description:`Order #${e.order_id}`,order_id:a.data.razorpay_order_id,handler:async s=>{try{if(!(await F.post("/payment/razorpay/verify",{razorpay_payment_id:s.razorpay_payment_id,razorpay_order_id:s.razorpay_order_id,razorpay_signature:s.razorpay_signature,order_id:e.order_id})).data.success)throw new Error("Payment verification failed");E(`/order-success/${e.order_id}`)}catch(a){T({open:!0,message:"Payment verification failed. Please contact support.",severity:"error"})}},prefill:{name:`${A.firstName} ${A.lastName}`,email:A.email,contact:A.phone},theme:{color:"#E91E63"}};new window.Razorpay(s).open()}}catch(a){let e="Failed to initialize payment. Please try again.";a.response&&a.response.data&&a.response.data.error?e=a.response.data.error:a.message&&(e=a.message),T({open:!0,message:e,severity:"error"})}};return a.jsxs(t,{sx:{width:"100%",maxWidth:1200,mx:"auto",mt:4,px:{xs:1,sm:2,md:3},pb:4},children:[a.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[a.jsx(r,{onClick:()=>E("/"),sx:{color:"#333"},children:a.jsx(i,{})}),a.jsx(n,{variant:"h5",sx:{fontWeight:600,color:"#222",fontFamily:'"Montserrat", sans-serif'},children:"Checkout"})]}),a.jsx(t,{sx:{mb:4},children:a.jsx(o,{activeStep:O,alternativeLabel:!0,children:P.map(e=>a.jsx(l,{children:a.jsx(d,{children:e})},e))})}),a.jsxs(c,{container:!0,spacing:3,children:[a.jsx(c,{item:!0,xs:12,lg:8,children:a.jsxs(h,{sx:{p:3},children:[(e=>{switch(e){case 0:return a.jsxs(t,{children:[a.jsxs(n,{variant:"h6",sx:{mb:2,fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:["Cart Items (",$.length,")"]}),a.jsx(t,{sx:{maxHeight:400,overflow:"auto"},children:$.map((e,s)=>a.jsx(S,{sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:a.jsx(z,{sx:{py:2,"&:last-child":{pb:2}},children:a.jsxs(t,{sx:{display:"flex",gap:2},children:[a.jsx(t,{component:"img",src:e.image||`https://sardarfashions.mycartly.in/uploads/products/1532365/${e.product_id}_v1.png`,alt:e.name,sx:{width:60,height:60,objectFit:"cover",borderRadius:1,backgroundColor:"#f5f5f5",flexShrink:0},onError:s=>{s.target.src.includes("_v1.png")?s.target.style.display="none":s.target.src=`https://sardarfashions.mycartly.in/uploads/products/1532365/${e.product_id}_v1.png`}}),a.jsxs(t,{sx:{flex:1,minWidth:0},children:[a.jsx(n,{variant:"subtitle2",sx:{fontWeight:600,mb:.5,fontFamily:'"Montserrat", sans-serif'},children:e.name}),a.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:.5,fontFamily:'"Nunito Sans", sans-serif'},children:["Quantity: ",e.quantity]}),e.selected_variants&&Object.keys(e.selected_variants).length>0&&a.jsx(t,{sx:{mb:.5},children:Object.entries(e.selected_variants).map(([e,s])=>a.jsx(N,{label:`${e}: ${s}`,size:"small",sx:{mr:.5,mb:.5,fontSize:"0.7rem"}},e))}),a.jsxs(n,{variant:"body2",sx:{fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:["₹",(e.price*e.quantity).toLocaleString()]})]})]})})},s))})]});case 1:return a.jsxs(t,{children:[a.jsx(n,{variant:"h6",sx:{mb:2,fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:"Shipping Details"}),a.jsxs(c,{container:!0,spacing:2,children:[a.jsx(c,{item:!0,xs:12,sm:6,children:a.jsx(_,{fullWidth:!0,label:"First Name *",value:A.firstName,onChange:te("firstName"),required:!0})}),a.jsx(c,{item:!0,xs:12,sm:6,children:a.jsx(_,{fullWidth:!0,label:"Last Name *",value:A.lastName,onChange:te("lastName"),required:!0})}),a.jsx(c,{item:!0,xs:12,sm:6,children:a.jsx(_,{fullWidth:!0,label:"Email *",type:"email",value:A.email,onChange:te("email"),required:!0})}),a.jsx(c,{item:!0,xs:12,sm:6,children:a.jsx(_,{fullWidth:!0,label:"Phone Number *",value:A.phone,onChange:te("phone"),required:!0})}),a.jsx(c,{item:!0,xs:12,children:a.jsx(_,{fullWidth:!0,label:"Address *",multiline:!0,rows:3,value:A.address,onChange:te("address"),required:!0})}),a.jsx(c,{item:!0,xs:12,sm:6,children:a.jsx(_,{fullWidth:!0,label:"City *",value:A.city,onChange:te("city"),required:!0})}),a.jsx(c,{item:!0,xs:12,sm:6,children:a.jsx(_,{fullWidth:!0,label:"State *",value:A.state,onChange:te("state"),required:!0})}),a.jsx(c,{item:!0,xs:12,sm:6,children:a.jsx(_,{fullWidth:!0,label:"Country",value:A.country,onChange:te("country")})}),a.jsx(c,{item:!0,xs:12,sm:6,children:a.jsx(_,{fullWidth:!0,label:"Pincode *",value:A.pincode,onChange:te("pincode"),required:!0})}),a.jsx(c,{item:!0,xs:12,children:a.jsx(_,{fullWidth:!0,label:"Landmark (Optional)",value:A.landmark,onChange:te("landmark")})})]})]});case 2:return a.jsxs(t,{children:[a.jsx(n,{variant:"h6",sx:{mb:2,fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:"Payment Method"}),a.jsxs(f,{component:"fieldset",sx:{width:"100%"},children:[a.jsx(j,{component:"legend",children:"Select Payment Method"}),a.jsxs(g,{value:U,onChange:e=>G(e.target.value),children:[Y&&a.jsx(b,{value:"razorpay",control:a.jsx(w,{}),label:a.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(v,{sx:{fontSize:20}}),a.jsxs(t,{children:[a.jsx(n,{variant:"body1",sx:{fontFamily:'"Montserrat", sans-serif'},children:"Pay Online (Razorpay)"}),a.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:"Credit/Debit Cards, UPI, Net Banking"})]})]}),sx:{border:"1px solid #eee",borderRadius:1,p:2,mb:1,width:"100%","&.Mui-checked":{borderColor:"#E91E63",bgcolor:"#fce4ec"}}}),J&&a.jsx(b,{value:"cod",control:a.jsx(w,{}),label:a.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(C,{sx:{fontSize:20}}),a.jsxs(t,{children:[a.jsx(n,{variant:"body1",sx:{fontFamily:'"Montserrat", sans-serif'},children:"Cash on Delivery (COD)"}),a.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:"Pay when you receive your order"})]})]}),sx:{border:"1px solid #eee",borderRadius:1,p:2,width:"100%","&.Mui-checked":{borderColor:"#E91E63",bgcolor:"#fce4ec"}}})]})]}),!Y&&!J&&a.jsx(u,{severity:"warning",sx:{mt:2},children:"No payment methods are currently available. Please contact support."})]});default:return"Unknown step"}})(O),a.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[a.jsx(x,{disabled:0===O,onClick:()=>{L(e=>e-1)},sx:{mr:1},children:"Back"}),a.jsx(t,{children:O===P.length-1?a.jsx(x,{variant:"contained",onClick:ne,disabled:D||!Y&&!J,sx:{bgcolor:"#E91E63",color:"white","&:hover":{bgcolor:"#C2185B"}},children:D?a.jsx(m,{size:20,color:"inherit"}):"Place Order"}):a.jsx(x,{variant:"contained",onClick:()=>{0===O?L(1):1===O&&re()&&L(2)},sx:{bgcolor:"#E91E63",color:"white","&:hover":{bgcolor:"#C2185B"}},children:"Next"})})]})]})}),a.jsx(c,{item:!0,xs:12,lg:4,children:a.jsxs(h,{sx:{p:3,height:"fit-content"},children:[a.jsx(n,{variant:"h6",sx:{mb:2,fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:"Order Summary"}),a.jsxs(t,{sx:{mb:2},children:[a.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[a.jsx(n,{sx:{fontFamily:'"Nunito Sans", sans-serif'},children:"Subtotal:"}),a.jsxs(n,{sx:{fontFamily:'"Montserrat", sans-serif'},children:["₹",Z.subtotal.toLocaleString()]})]}),a.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[a.jsx(n,{children:"Shipping:"}),a.jsx(n,{children:0===Z.shipping?"Free":`₹${Z.shipping.toLocaleString()}`})]}),a.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[a.jsx(n,{children:"Tax:"}),a.jsx(n,{sx:{fontStyle:"italic",color:"#6b7280"},children:"Included"})]}),a.jsx(y,{sx:{my:1}}),a.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[a.jsx(n,{variant:"h6",sx:{fontWeight:600},children:"Total:"}),a.jsxs(n,{variant:"h6",sx:{fontWeight:600},children:["₹",Z.total.toLocaleString()]})]})]}),a.jsx(u,{severity:"info",sx:{mb:2},children:a.jsx(n,{variant:"body2",children:"All taxes are included in the product prices. No additional GST will be charged."})}),V&&a.jsx(u,{severity:"info",sx:{mb:2},children:a.jsx(n,{variant:"body2",children:"Your order will be shipped via Shiprocket for fast and reliable delivery."})}),a.jsx(x,{variant:"contained",fullWidth:!0,size:"large",onClick:ie,disabled:D,sx:{py:1.5,bgcolor:"#E91E63",color:"white","&:hover":{bgcolor:"#C2185B"},fontSize:"1rem",fontWeight:600},children:D?a.jsx(m,{size:24,color:"inherit"}):`Place Order - ₹${Z.total.toLocaleString()}`})]})})]}),a.jsx(p,{open:B.open,autoHideDuration:6e3,onClose:()=>T({...B,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:a.jsx(u,{onClose:()=>T({...B,open:!1}),severity:B.severity,sx:{width:"100%"},children:B.message})})]})};export{E as default};
