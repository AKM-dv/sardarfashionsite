import{a as e,r as a,j as s,B as t,I as r,aq as i,T as n,S as o,d as l,e as d,N as c,aB as m,h as x,C as h,a7 as p,A as u,m as y,ax as f,aC as j,aD as g,aE as b,J as v,aF as _,aG as w,f as C,aH as S,aI as N,al as z}from"./mui-CYltanDZ.js";import{u as k,a as F}from"./index-eKRakX8v.js";import{u as W}from"./router-Bir15TBb.js";import"./vendor-HnKmhvXM.js";import"./utils-CSgk65FE.js";const P=["Cart Review","Shipping Details","Payment"],E=()=>{const E=W();e("(max-width:768px)");const{cartItems:q,getCartTotal:I,isLoggedIn:M,customerData:$}=k(),[O,L]=a.useState(0),[D,R]=a.useState(!1),[B,T]=a.useState({open:!1,message:"",severity:"success"}),[A,H]=a.useState({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",country:"India",pincode:"",landmark:""}),[G,U]=a.useState("razorpay"),[J,Q]=a.useState(!0),[Y,K]=a.useState(!0),[V,X]=a.useState(!0),[Z,ee]=a.useState({subtotal:0,shipping:0,tax:0,total:0});a.useEffect(()=>{M&&0!==q.length?($&&H(e=>({...e,email:$.email||"",firstName:$.name?.split(" ")[0]||"",lastName:$.name?.split(" ").slice(1).join(" ")||""})),se(),ae()):E("/")},[M,q,$,E]);const ae=async()=>{try{const e=await F.get("/settings"),a=e.data?.settings||{};Q(!1!==a.cod_enabled),K(!1!==a.razorpay_enabled),X(!1!==a.shiprocket_enabled)}catch(e){}},se=()=>{const e=I();ee({subtotal:e,shipping:0,tax:0,total:e})},te=e=>a=>{H(s=>({...s,[e]:a.target.value}))},re=()=>{const e=["firstName","lastName","email","phone","address","city","state","pincode"].filter(e=>!A[e].trim());if(e.length>0)return T({open:!0,message:`Please fill in all required fields: ${e.join(", ")}`,severity:"error"}),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(A.email))return T({open:!0,message:"Please enter a valid email address",severity:"error"}),!1;if(!/^[6-9]\d{9}$/.test(A.phone))return T({open:!0,message:"Please enter a valid 10-digit phone number",severity:"error"}),!1;return!!/^[1-9][0-9]{5}$/.test(A.pincode)||(T({open:!0,message:"Please enter a valid 6-digit pincode",severity:"error"}),!1)},ie=()=>{0!==O?ne():L(1)},ne=async()=>{if(re())if(A.firstName&&A.lastName&&A.email){R(!0);try{const e=q.map(e=>({product_id:e.product_id,quantity:e.quantity,price:e.price,selected_variants:e.selected_variants||e.variants||{},cart_item_key:e.cart_item_key||`${e.product_id}_no-variants`,name:e.name,subtotal:e.subtotal||e.price*e.quantity})),a={customer_details:{firstName:A.firstName.trim(),lastName:A.lastName.trim(),email:A.email.trim(),phone:A.phone.trim(),address:A.address.trim(),city:A.city.trim(),state:A.state.trim(),country:A.country.trim()||"India",pincode:A.pincode.trim(),landmark:A.landmark?.trim()||""},items:e,payment_method:G,order_summary:{subtotal:Z.subtotal,shipping:Z.shipping,tax:Z.tax,total:Z.total},shiprocket_enabled:V},s=await F.post("/orders/create",a);if(!s.data.success)throw new Error(s.data.error||"Failed to create order");{const e=s.data.order_id,a=s.data.total_amount;if("razorpay"===G&&Y&&e){const s={order_id:e,total:a};await oe(s)}else E(`/order-success/${e}`)}}catch(e){let a="Failed to place order. Please try again.";e.response?.data?e.response.data.error?a=e.response.data.error:e.response.data.message?a=e.response.data.message:"string"==typeof e.response.data&&(a=e.response.data):e.message&&(a=e.message),T({open:!0,message:a,severity:"error"})}finally{R(!1)}}else T({open:!0,message:"Please fill in all required customer details",severity:"error"})},oe=async e=>{try{try{const e=await F.get("/payment/razorpay/status");if(!e.data.configured||!e.data.enabled)throw new Error(e.data.message||"Payment gateway not available")}catch(a){}const s=await F.post("/payment/razorpay/create",{order_id:e.order_id,amount:Z.total,currency:"INR",customer_details:A});if(!s.data.success)throw new Error(s.data.error||"Failed to initialize payment");{const a={key:s.data.razorpay_key,amount:s.data.amount,currency:"INR",name:"Sardar Fashions",description:`Order #${e.order_id}`,order_id:s.data.razorpay_order_id,handler:async a=>{try{if(!(await F.post("/payment/razorpay/verify",{razorpay_payment_id:a.razorpay_payment_id,razorpay_order_id:a.razorpay_order_id,razorpay_signature:a.razorpay_signature,order_id:e.order_id})).data.success)throw new Error("Payment verification failed");E(`/order-success/${e.order_id}`)}catch(s){T({open:!0,message:"Payment verification failed. Please contact support.",severity:"error"})}},prefill:{name:`${A.firstName} ${A.lastName}`,email:A.email,contact:A.phone},theme:{color:"#E91E63"}};new window.Razorpay(a).open()}}catch(s){let e="Failed to initialize payment. Please try again.";s.response&&s.response.data&&s.response.data.error?e=s.response.data.error:s.message&&(e=s.message),T({open:!0,message:e,severity:"error"})}};return s.jsxs(t,{sx:{width:"100%",maxWidth:1200,mx:"auto",mt:4,px:{xs:1,sm:2,md:3},pb:4},children:[s.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[s.jsx(r,{onClick:()=>E("/"),sx:{color:"#333"},children:s.jsx(i,{})}),s.jsx(n,{variant:"h5",sx:{fontWeight:600,color:"#222",fontFamily:'"Montserrat", sans-serif'},children:"Checkout"})]}),s.jsx(t,{sx:{mb:4},children:s.jsx(o,{activeStep:O,alternativeLabel:!0,children:P.map(e=>s.jsx(l,{children:s.jsx(d,{children:e})},e))})}),s.jsxs(c,{container:!0,spacing:3,children:[s.jsx(c,{item:!0,xs:12,lg:8,children:s.jsxs(m,{sx:{p:3},children:[(e=>{switch(e){case 0:return s.jsxs(t,{children:[s.jsxs(n,{variant:"h6",sx:{mb:2,fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:["Cart Items (",q.length,")"]}),s.jsx(t,{sx:{maxHeight:400,overflow:"auto"},children:q.map((e,a)=>s.jsx(S,{sx:{mb:2,boxShadow:"none",border:"1px solid #eee"},children:s.jsx(N,{sx:{py:2,"&:last-child":{pb:2}},children:s.jsxs(t,{sx:{display:"flex",gap:2},children:[s.jsx(t,{component:"img",src:e.image||"",alt:e.name,sx:{width:60,height:60,objectFit:"cover",borderRadius:1,backgroundColor:"#f5f5f5",flexShrink:0},onError:e=>{e.target.style.display="none"}}),s.jsxs(t,{sx:{flex:1,minWidth:0},children:[s.jsx(n,{variant:"subtitle2",sx:{fontWeight:600,mb:.5,fontFamily:'"Montserrat", sans-serif'},children:e.name}),s.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:.5,fontFamily:'"Nunito Sans", sans-serif'},children:["Quantity: ",e.quantity]}),e.selected_variants&&Object.keys(e.selected_variants).length>0&&s.jsx(t,{sx:{mb:.5},children:Object.entries(e.selected_variants).map(([e,a])=>s.jsx(z,{label:`${e}: ${a}`,size:"small",sx:{mr:.5,mb:.5,fontSize:"0.7rem"}},e))}),s.jsxs(n,{variant:"body2",sx:{fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:["₹",(e.price*e.quantity).toLocaleString()]})]})]})})},a))})]});case 1:return s.jsxs(t,{children:[s.jsx(n,{variant:"h6",sx:{mb:2,fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:"Shipping Details"}),s.jsxs(c,{container:!0,spacing:2,children:[s.jsx(c,{item:!0,xs:12,sm:6,children:s.jsx(C,{fullWidth:!0,label:"First Name *",value:A.firstName,onChange:te("firstName"),required:!0})}),s.jsx(c,{item:!0,xs:12,sm:6,children:s.jsx(C,{fullWidth:!0,label:"Last Name *",value:A.lastName,onChange:te("lastName"),required:!0})}),s.jsx(c,{item:!0,xs:12,sm:6,children:s.jsx(C,{fullWidth:!0,label:"Email *",type:"email",value:A.email,onChange:te("email"),required:!0})}),s.jsx(c,{item:!0,xs:12,sm:6,children:s.jsx(C,{fullWidth:!0,label:"Phone Number *",value:A.phone,onChange:te("phone"),required:!0})}),s.jsx(c,{item:!0,xs:12,children:s.jsx(C,{fullWidth:!0,label:"Address *",multiline:!0,rows:3,value:A.address,onChange:te("address"),required:!0})}),s.jsx(c,{item:!0,xs:12,sm:6,children:s.jsx(C,{fullWidth:!0,label:"City *",value:A.city,onChange:te("city"),required:!0})}),s.jsx(c,{item:!0,xs:12,sm:6,children:s.jsx(C,{fullWidth:!0,label:"State *",value:A.state,onChange:te("state"),required:!0})}),s.jsx(c,{item:!0,xs:12,sm:6,children:s.jsx(C,{fullWidth:!0,label:"Country",value:A.country,onChange:te("country")})}),s.jsx(c,{item:!0,xs:12,sm:6,children:s.jsx(C,{fullWidth:!0,label:"Pincode *",value:A.pincode,onChange:te("pincode"),required:!0})}),s.jsx(c,{item:!0,xs:12,children:s.jsx(C,{fullWidth:!0,label:"Landmark (Optional)",value:A.landmark,onChange:te("landmark")})})]})]});case 2:return s.jsxs(t,{children:[s.jsx(n,{variant:"h6",sx:{mb:2,fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:"Payment Method"}),s.jsxs(f,{component:"fieldset",sx:{width:"100%"},children:[s.jsx(j,{component:"legend",children:"Select Payment Method"}),s.jsxs(g,{value:G,onChange:e=>U(e.target.value),children:[Y&&s.jsx(b,{value:"razorpay",control:s.jsx(_,{}),label:s.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(v,{sx:{fontSize:20}}),s.jsxs(t,{children:[s.jsx(n,{variant:"body1",sx:{fontFamily:'"Montserrat", sans-serif'},children:"Pay Online (Razorpay)"}),s.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:"Credit/Debit Cards, UPI, Net Banking"})]})]}),sx:{border:"1px solid #eee",borderRadius:1,p:2,mb:1,width:"100%","&.Mui-checked":{borderColor:"#E91E63",bgcolor:"#fce4ec"}}}),J&&s.jsx(b,{value:"cod",control:s.jsx(_,{}),label:s.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(w,{sx:{fontSize:20}}),s.jsxs(t,{children:[s.jsx(n,{variant:"body1",sx:{fontFamily:'"Montserrat", sans-serif'},children:"Cash on Delivery (COD)"}),s.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontFamily:'"Nunito Sans", sans-serif'},children:"Pay when you receive your order"})]})]}),sx:{border:"1px solid #eee",borderRadius:1,p:2,width:"100%","&.Mui-checked":{borderColor:"#E91E63",bgcolor:"#fce4ec"}}})]})]}),!Y&&!J&&s.jsx(u,{severity:"warning",sx:{mt:2},children:"No payment methods are currently available. Please contact support."})]});default:return"Unknown step"}})(O),s.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[s.jsx(x,{disabled:0===O,onClick:()=>{L(e=>e-1)},sx:{mr:1},children:"Back"}),s.jsx(t,{children:O===P.length-1?s.jsx(x,{variant:"contained",onClick:ne,disabled:D||!Y&&!J,sx:{bgcolor:"#E91E63",color:"white","&:hover":{bgcolor:"#C2185B"}},children:D?s.jsx(h,{size:20,color:"inherit"}):"Place Order"}):s.jsx(x,{variant:"contained",onClick:()=>{0===O?L(1):1===O&&re()&&L(2)},sx:{bgcolor:"#E91E63",color:"white","&:hover":{bgcolor:"#C2185B"}},children:"Next"})})]})]})}),s.jsx(c,{item:!0,xs:12,lg:4,children:s.jsxs(m,{sx:{p:3,height:"fit-content"},children:[s.jsx(n,{variant:"h6",sx:{mb:2,fontWeight:600,fontFamily:'"Montserrat", sans-serif'},children:"Order Summary"}),s.jsxs(t,{sx:{mb:2},children:[s.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[s.jsx(n,{sx:{fontFamily:'"Nunito Sans", sans-serif'},children:"Subtotal:"}),s.jsxs(n,{sx:{fontFamily:'"Montserrat", sans-serif'},children:["₹",Z.subtotal.toLocaleString()]})]}),s.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[s.jsx(n,{children:"Shipping:"}),s.jsx(n,{children:0===Z.shipping?"Free":`₹${Z.shipping.toLocaleString()}`})]}),s.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[s.jsx(n,{children:"Tax:"}),s.jsx(n,{sx:{fontStyle:"italic",color:"#6b7280"},children:"Included"})]}),s.jsx(y,{sx:{my:1}}),s.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[s.jsx(n,{variant:"h6",sx:{fontWeight:600},children:"Total:"}),s.jsxs(n,{variant:"h6",sx:{fontWeight:600},children:["₹",Z.total.toLocaleString()]})]})]}),s.jsx(u,{severity:"info",sx:{mb:2},children:s.jsx(n,{variant:"body2",children:"All taxes are included in the product prices. No additional GST will be charged."})}),V&&s.jsx(u,{severity:"info",sx:{mb:2},children:s.jsx(n,{variant:"body2",children:"Your order will be shipped via Shiprocket for fast and reliable delivery."})}),s.jsx(x,{variant:"contained",fullWidth:!0,size:"large",onClick:ie,disabled:D,sx:{py:1.5,bgcolor:"#E91E63",color:"white","&:hover":{bgcolor:"#C2185B"},fontSize:"1rem",fontWeight:600},children:D?s.jsx(h,{size:24,color:"inherit"}):`Place Order - ₹${Z.total.toLocaleString()}`})]})})]}),s.jsx(p,{open:B.open,autoHideDuration:6e3,onClose:()=>T({...B,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(u,{onClose:()=>T({...B,open:!1}),severity:B.severity,sx:{width:"100%"},children:B.message})})]})};export{E as default};
